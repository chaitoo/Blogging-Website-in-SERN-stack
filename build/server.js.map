{"version":3,"sources":["../src/server.js"],"names":["mysql","require","session","MySQLStore","passport","app","session_options","checkExpirationInterval","expiration","createDatabaseTable","schema","tableName","columnNames","session_id","expires","data","sql_config","host","port","user","password","database","connectionLimit","pool","createPool","sessionStore","set","join","__dirname","use","static","json","urlencoded","extended","secret","store","resave","saveUninitialized","cookie","secure","initialize","models","isLoggedIn","req","res","next","isAuthenticated","redirect","navbar","get","fetch","then","resp","festGridContainer","render","title","catch","e","console","log","listcontent","fest_id","params","_id","fest_title","fest_content","festData","performers","length","artists","userLoggedIn","user_id","can","role","id","festContent","artist_data","status","articlesListContent","blog_id","blog_title","blogContent","articlesPageBanner","accessParams","post","owner","writer_id","authenticate","successRedirect","failureRedirect","destroy","err","sequelize","sync","listen"],"mappings":"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","file":"server.js","sourcesContent":["import path from 'path';\nimport express from 'express';\nimport bodyParser from 'body-parser';\nimport React from 'react';\nimport { renderToString } from 'react-dom/server';\nimport { StaticRouter } from 'react-router';\nimport { renderRoutes } from 'react-router-config';\n\nvar mysql = require('mysql');\nvar session = require('express-session');\nvar MySQLStore = require('express-mysql-session')(session);\nvar passport   = require('passport')\n\nimport ClientRoutes from './client-routes';\n\nimport apiRoutes from './api-routes';\nimport FestivalListPage from './react/templates/festival-list.js';\nimport FestivalGridContainer from './react/templates/festivalGrid-container';\nimport FestivalPage from './react/templates/festival-page';\nimport Navbar from './react/components/Navbar.js';\nimport ArticlesListPage from './react/templates/articles-list-page';\nimport ArticlePageBanner from './react/components/ArticlePageBanner';\n\nimport accessRights from './rbac';\n\nconst app = new express();\n\nconst session_options = {\n    checkExpirationInterval: 1000 * 60 * 15, // 15mins\n    expiration: 1000 * 60 * 60 * 24 * 7, // 1 week\n    createDatabaseTable: true,\n    schema: {\n        tableName: 'sessions',\n        columnNames: {\n            session_id: 'session_id',\n            expires: 'expires',\n            data: 'data'\n        }\n    }\n};\n\nconst sql_config = {\n    host: 'localhost',\n    port: 3306,\n    user: 'root',\n    password: 'musejam',\n    database: 'musefests',\n    connectionLimit : 100\n};\n\nconst pool = mysql.createPool(sql_config);\n\nvar sessionStore = new MySQLStore(session_options, pool);\n\napp.set('view engine', 'ejs');\napp.set('views', path.join(__dirname, 'views'));\n\napp.use(express.static(path.join(__dirname, 'static')));\napp.use(bodyParser.json());\napp.use(bodyParser.urlencoded({extended: true}));\n\n\napp.use(session({\n    //key: 'session_cookie_name',\n    secret: 'session_cookie_secret',\n    store: sessionStore,\n    resave: false,\n    saveUninitialized: false,\n    cookie: { secure: false }\n}));\n\napp.use(passport.initialize());\napp.use(passport.session());\n//Models\nvar models = require(\"./models\");\n\n\n\n\napp.use('/api', apiRoutes);\n\nfunction isLoggedIn(req, res, next) {\n\n    if (req.isAuthenticated())\n        return next();\n    res.redirect('/signin');\n};\n\n\nlet navbar;\napp.use( (req, res, next) => {\n  let user = {};\n  if(req.isAuthenticated())\n  {\n    user = req.user;\n  }\n  navbar = renderToString(\n    <Navbar userInfo = {user}/>\n  );\n  next();\n})\n\n\napp.get('/', (req, res) => {\n    fetch('http://test.musefests.com/api/fests')\n      .then(resp => resp.json())\n      .then(function (data) {\n          const festGridContainer = renderToString(\n            <FestivalGridContainer fests = {data} />\n          );\n          res.render('index', {title: 'Musefests', navbar, festGridContainer });\n\n      })\n      .catch(function(e) {\n        console.log(\"err api fetching\"+e);\n      });\n});\n\napp.get('/festivals', isLoggedIn, (req, res) => {\n\n  fetch('http://test.musefests.com/api/fests')\n    .then(resp => resp.json())\n    .then(function (data) {\n      const listcontent = renderToString(\n        <FestivalListPage initialFests = {data} />\n      );\n      res.render('festival-listing', {title: 'Musefests', navbar, listcontent });\n\n    })\n    .catch(function(e) {\n      console.log(\"err api fetching\"+e);\n    });\n\n})\n\napp.get('/festival/:_id/:title', (req, res) => {\n  let user = req.user;\n  let fest_id = req.params._id;\n  let fest_title = req.params.title\n  fetch('http://test.musefests.com/api/festival/'+fest_id)\n    .then(resp => resp.json())\n    .then(function (data) {\n      const fest_content = renderToString(\n        <FestivalPage festContent = {data.festData} userInfo = {user} />\n      );\n      let performers = [];\n      if(data.performers.length!=0)\n      {\n        performers = data.performers[0];\n      }\n\n\n      // const performers_content = renderToString(\n      //   <Performers performersList = {data.performers[0]} />\n      // );\n\n      res.render('festival-page', {title: fest_title , navbar, fest_content, performers });\n\n    })\n    .catch(function(e) {\n      console.log(\"err api fetching\"+e);\n    });\n})\n\napp.get('/add/festival', (req, res) => {\n  fetch('http://test.musefests.com/api/artists/all')\n  .then(resp => resp.json())\n  .then( (data) => {\n    let artists = data;\n    res.render('add-festival', {title: \"Add New Festival\",navbar, artists})\n  })\n  .catch(function(e) {\n    console.log(\"err api fetching\"+e);\n  });\n});\n\napp.get('/edit/festival/:fest_id/:user_id/:fest_title', isLoggedIn, (req, res) => {\n  var userLoggedIn = req.user;\n  var fest_id = req.params.fest_id;\n  var user_id = req.params.user_id;\n  if(accessRights.can(userLoggedIn.role,'edit') && userLoggedIn.id == user_id)\n  {\n    fetch('http://test.musefests.com/api/festival/'+fest_id)\n      .then(resp => resp.json())\n      .then(function (data){\n        let festContent = data.festData;\n        fetch('http://test.musefests.com/api/artists/all')\n        .then(resp => resp.json())\n        .then( (artist_data) => {\n          let artists = artist_data;\n          res.render('edit-festival',{title:\"Edit Festival\",navbar, festContent, artists, user_id})\n        })\n        .catch(function(e) {\n          console.log(\"err api fetching\"+e);\n        });\n      })\n      .catch(function(e) {\n        console.log(\"err api fetching\"+e);\n      });\n  }\n  else {\n    res.status(401).json(\"Not Authorized!!\");\n  }\n});\n\napp.get('/articles', (req, res) => {\n  fetch('http://test.musefests.com/api/articles')\n    .then(resp => resp.json())\n    .then(function (data) {\n      const articlesListContent = renderToString(\n        <ArticlesListPage articles = {data} />\n      );\n      res.render('article-listing', {title: 'Articles', navbar, articlesListContent });\n\n    })\n    .catch(function(e) {\n      console.log(\"err api fetching\"+e);\n    });\n});\n\napp.get('/article/:_id/:title', isLoggedIn, (req, res) => {\n  let blog_id = req.params._id;\n  let blog_title = req.params.title;\n  let userLoggedIn = req.user;\n  fetch('http://test.musefests.com/api/articles/'+blog_id)\n    .then(resp => resp.json())\n    .then(function (data) {\n      let blogContent = data[0];\n      const articlesPageBanner = renderToString(\n        <ArticlePageBanner blogDetails = {blogContent} userInfo = {userLoggedIn} />\n      );\n      res.render('article-page', {title: blog_title, navbar, blogContent, articlesPageBanner });\n\n    })\n    .catch(function(e) {\n      console.log(\"err api fetching\"+e);\n    });\n});\n\napp.get('/add/article',isLoggedIn, (req, res) => {\n  let userLoggedIn = req.user;\n  res.render('add-article', {title: \"Add New Article\", navbar, user_id: userLoggedIn.id})\n});\n\napp.get('/edit/article/:blog_id/:user_id/:blog_title', isLoggedIn, (req, res) => {\n  let blog_id = req.params.blog_id;\n  let user_id = req.params.user_id;\n  let blog_title = req.params.blog_title;\n  let userLoggedIn = req.user;\n  fetch('http://test.musefests.com/api/articles/'+blog_id)\n    .then(resp => resp.json())\n    .then(function (data) {\n      let blogContent = data[0];\n      let accessParams = {\n        user:{},\n        post:{}\n      };\n      accessParams.user.id=userLoggedIn.id;\n      accessParams.post.owner = blogContent.writer_id;\n      if(accessRights.can(userLoggedIn.role,'edit',accessParams) && userLoggedIn.id == user_id)\n      {\n        res.render('edit-article',{title:blog_title, navbar, blogContent, user_id});\n      }\n    })\n    .catch(function(e) {\n      console.log(\"err api fetching\"+e);\n    });\n})\n\napp.get('/signup', (req, res) => {\n  res.render('signup',{title:'SignUp', navbar});\n})\n\napp.get('/signin', (req, res) => {\n  res.render('signin',{title:'SignIn', navbar});\n})\n\napp.post('/api/signup', passport.authenticate('local-signup', {\n       successRedirect: '/',\n       failureRedirect: '/signup'\n   }\n));\n\napp.post('/api/signin', passport.authenticate('local-signin', {\n            successRedirect: '/festivals',\n            failureRedirect: '/signin'\n        }\n    ));\n\napp.get('/logout', (req, res) => {\n  req.session.destroy(function(err) {\n    console.log(\"session destroyed\");\n        res.redirect('/');\n    });\n})\n\nrequire('./passport.js')(passport, models.user);\n\n//Sync Database\nmodels.sequelize.sync().then(function() {\n    console.log('Nice! Database looks fine')\n}).catch(function(err) {\n    console.log(err, \"Something went wrong with the Database Update!\")\n});\n\n\n\n//console.log(initialData);\n\n// app.get('*', (req, res) => {\n//   let context = {};\n//   const content = renderToString(\n//     <StaticRouter location={req.url} context={context}>\n//       <ClientRoutes/>\n//     </StaticRouter>\n//   );\n//   res.render('index', {title: 'Musefests', content });\n// });\n\napp.listen(2525);\nconsole.log(\"app running at test.musefests.com\");\n"]}